<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="" />
    <meta name="author" content="" />
    <!--[if IE]>
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <![endif]-->

     <style>
        @import url(//cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.2/leaflet.css);
        @import url(../style.css?aea6f0a);

        path {
              /*fill: #000;
              fill-opacity: .2;*/
              stroke: #fff;
              stroke-width: 0.5px;
          }

          }
    </style>
        
    <title>OCHA Sudan 3W Dashboard</title>
    <!-- BOOTSTRAP CORE STYLE  -->
    <link href="assets/css/bootstrap.css" rel="stylesheet" />
    <!-- FONT AWESOME STYLE  -->
    <link href="assets/css/font-awesome.css" rel="stylesheet" />
    <!-- CUSTOM STYLE  -->
    <link href="assets/css/style.css" rel="stylesheet" />
    <!-- GOOGLE FONT -->
    <link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css' />

</head>
<body>
    <div class="navbar navbar-inverse set-radius-zero" >
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="http://www.unocha.org/sudan/" target="_blank">

                    <img src="assets/img/logo.png" />
                </a>

            </div>

            <div class="right-div">
                <a href="http://www.humanitarianresponse.info/home" class="btn btn-danger pull-right" target="_blank">HR.info</a>
            </div>
        </div>
    </div>
    <!-- LOGO HEADER END-->

    <section class="menu-section">
        <div class="container">
            <div class="row">
                <div class="col-md-12">
                    <div class="navbar-collapse collapse ">
                        <ul id="menu-top" class="nav navbar-nav navbar-right">

                            <li><a href="index.html" class="menu-top-active">Overview</a></li>
          
                            <li><a href="locality.html">3W Locality Dashboard</a></li>
                           

                        </ul>
                    </div>
                </div>

            </div>
        </div>
    </section>
     <!-- MENU SECTION END-->

    <div class="content-wrapper">
         <div class="container">
            <div class="row pad-botm">
                <div class="col-md-12">
                    <h4 class="header-line" style="color:#FF9F19">OCHA Sudan - Who does What Where - Presence Dashboard</h4>
                    
                                </div>
            </div>

            <div class="row">
            
                    <div class="col-md-3 col-sm-3 col-xs-6">
                          <div class="alert alert-info back-widget-set text-center">
                                <i class="fa fa-child fa-5x"></i>
                                <h3><strong>11&nbsp; Sectors</strong></h3>
                               Active In 2015
                          </div>
                        </div>
                  <div class="col-md-3 col-sm-3 col-xs-6">
                          <div class="alert alert-success back-widget-set text-center">
                                <i class="fa fa-users fa-5x"></i>
                                <h3><strong>112 Organisations</strong></h3>
                                Appealing for HRP In 2015
                            </div>
                        </div>
                   <div class="col-md-3 col-sm-3 col-xs-6">
                          <div class="alert alert-danger back-widget-set text-center">
                                <i class="fa fa-folder-open fa-5x"></i>
                                <h3><strong>347 Projects</strong></h3>
                                Planned In 2015
                            </div>
                        </div>     
                   <div class="col-md-3 col-sm-3 col-xs-6">
                          <div class="alert alert-warning back-widget-set text-center">
                                <i class="fa fa-cogs fa-5x"></i>
                                <h3><strong>5,540 Aid Workers</strong></h3>
                               In <strong style="color:#E5A67F">59</strong> UN/IO/INGOs Across Darfur
                            </div>
                        </div>

            </div>              

            <div class="row">
                <div class="col-md-12 col-sm-12 col-xs-12">
                    <div class="panel panel-primary">
                        <div class="panel-heading">
                           3W Overview
                        </div>
                        <div class="panel-body">
                            <p class="alert alert-info">The main purpose of this 3W dashboard is to highlight the operational presence of humanitarian partners in Sudan by sector and geographic coverage.
                              The 3Ws dashboard helps organizations identify potential partners, possible presence overlaps, or gaps, and visually provides a general understanding of areas of intervention.

                              <br />

                              The map below combines the humanitarian needs and partners’ presence with a focus on geographic areas. It also aims to provide a general overview and understanding of the presence and scope of different needs.
                            </p>
                        </div>    
                     </div>   
                  </div>    
                </div>

             <div class="row">
                <div class="col-md-4 col-sm-4 col-xs-12">
                    <div class="panel panel-danger">
                        <div class="panel-heading text-center">
                           People In Need and Targeted
                        </div>
                        <div class="panel-body">
                          <img src="assets/img/NeedTargeted.jpg" class="img-responsive" alt=""/>
                        </div>    
                     </div>   
                </div>    
               
               <div class="col-md-8 col-sm-8 col-xs-12">
                    <div class="panel panel-info">
                        <div class="panel-heading text-center">
                          Humanitarian Needs vs Actors Presence Map
                        </div>
                        <div class="panel-body">
                          <p class="alert alert-warning">Information on ranking of localities is based on needs analysis as a part of the Sudan Humanitarian Need Overview 2015 (HNO) and presence of actors per state.<strong style="color:#E5A67F"> Hover</strong> on map to see more data.</p>  
                          <div id="needsMap" style="margin-left: auto; margin-right: auto; width: 100%; height: 400px"></div>
                        </div>    
                    </div>   
                </div>
            </div>

        </div>
    </div>
     <!-- CONTENT-WRAPPER SECTION END-->

    <section class="footer-section">
        <div class="container">
            <div class="row">
                <div class="col-md-12">
                   &copy; 2015 UNOCHA Sudan |<a href="http://www.unocha.org/sudan/" target="_blank"  > Designed by : UNOCHA Sudan IM Team</a> 
                </div>

            </div>
        </div>
    </section>
      <!-- FOOTER SECTION END-->

    <!-- JAVASCRIPT FILES PLACED AT THE BOTTOM TO REDUCE THE LOADING TIME  -->
    <!-- CORE JQUERY  -->
    <script src="assets/js/jquery-1.10.2.js"></script>
    <!-- BOOTSTRAP SCRIPTS  -->
    <script src="assets/js/bootstrap.js"></script>
      <!-- CUSTOM SCRIPTS  -->
    <script src="assets/js/custom.js"></script>

    <script type="text/javascript" src="assets/js/d3.js"></script>
    <script src="http://cdn.leafletjs.com/leaflet-0.7/leaflet.js"></script>


     <!-- Javascript Code -->
    <script>

      //Define quantize scale to sort data values into buckets of color
      var color = d3.scale.quantize()
                .range(['#FFEDA0',
                    '#FED976',
                    '#FC4E2A',
                    '#BD0026',
                    '#800026'
                    ]);
                //Colors taken from colorbrewer.js, included in the D3 download

        var map = L.map('needsMap').setView([15.51, 32.54], 5);

        L.tileLayer('https://{s}.tiles.mapbox.com/v3/{id}/{z}/{x}/{y}.png', {
          maxZoom: 5,
          minZoom: 5,
          attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, ' +
            '<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
            'Imagery © <a href="http://mapbox.com">Mapbox</a>',
          id: 'examples.map-i875mjb7'
        }).addTo(map);

        // Add an SVG element to Leaflet’s overlay pane
        var svg = d3.select(map.getPanes().overlayPane).append("svg"),
          g = svg.append("g").attr("class", "leaflet-zoom-hide");

        //Load in state data
        d3.csv("assets/data/Needs.csv", function(data) {

        //Set input domain for color scale
        color.domain([
          d3.min(data, function(d) { return d.Need; }), 
          d3.max(data, function(d) { return d.Need; })
        ]);


        d3.json("assets/data/Locality.json", function(geoShape) {
        
        //  create a d3.geo.path to convert GeoJSON to SVG
        var transform = d3.geo.transform({point: projectPoint}),
                path = d3.geo.path().projection(transform);


        //Merge the Humanitarian needs. data and GeoJSON
          //Loop through once for each locality need. data value
          for (var i = 0; i < data.length; i++) {
        
            //Grab locality name
            var dataLocality = data[i].LOCALITY;
            
            //Grab data value, and convert from string to float
            var dataValue = parseFloat(data[i].Need);

            //Grab needs legend
            var needs = data[i].Assessed_Needs;
        
            //Find the corresponding locality inside the GeoJSON
            for (var j = 0; j < geoShape.features.length; j++) {
            
              var jsonLocality = geoShape.features[j].properties.Locality;
        
              if (dataLocality == jsonLocality) {
            
                //Copy the data value into the JSON
                geoShape.features[j].properties.value = dataValue;
                geoShape.features[j].properties.need = needs;
                
                //Stop looking through the JSON
                break;
                
              }
            }   
          }


        // create path elements for each of the features
        d3_features = g.selectAll("path")
          .data(geoShape.features)
          .enter()
          .append("path")
          .style("fill", function(d) {
                //Get data value
                var value = d.properties.value;
                
                if (value) {
                  //If value exists…
                  return color(value);
                } else {
                  //If value is undefined…
                  return "#ccc";
                }
             });
      
        //Load in cities data
          d3.csv("assets/data/3W_Org.csv", function(data) {

            g.selectAll("circle")
               .data(data)
               .enter()
               .append("circle")
               .attr("cx", function(d) {
                 return project([d.lon, d.lat])[0];
               })
               .attr("cy", function(d) {
                 return project([d.lon, d.lat])[1];
               })
               .attr("r", function(d) {
                return Math.sqrt(parseInt(d.Organisation * 4));
               })
               .style("fill", "#2255D4")
               .style("opacity", 0.75)
               .append("title")
               .text(function(d) {
                return "State: " + d.State + "\nPresent organization: " + d.Organisation + "\nOrganizations names:\n" + d.Name;
               });
            
          });

        map.on("viewreset", reset);

        reset();

        // fit the SVG element to leaflet's map layer
        function reset() {
            
          bounds = path.bounds(geoShape);

          var topLeft = bounds[0],
            bottomRight = bounds[1];

          svg .attr("width", bottomRight[0] - topLeft[0])
            .attr("height", bottomRight[1] - topLeft[1])
            .style("left", topLeft[0] + "px")
            .style("top", topLeft[1] + "px");

          g .attr("transform", "translate(" + -topLeft[0] + "," 
                                            + -topLeft[1] + ")");

          // initialize the path data 
          d3_features.attr("d", path)
            .style("fill-opacity", 0.4)
            .attr('fill','blue')
            .append("title")
              .text(function(d) {
                  return "State: " + d.properties.State + "\nLocality: " + d.properties.Locality + "\nHumanitarian needs: " + d.properties.need;
               });
        } 

        // Use Leaflet to implement a D3 geometric transformation.
        function projectPoint(x, y) {
          var point = map.latLngToLayerPoint(new L.LatLng(y, x));
          this.stream.point(point.x, point.y);
        }

        function project(x) {
            var point = map.latLngToLayerPoint(new L.LatLng(x[1], x[0]));
            return [point.x, point.y];
        }


      })

        })

    </script>

</body>
</html>
